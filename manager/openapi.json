{"openapi":"3.1.0","info":{"title":"manager","description":"","license":{"name":""},"version":"0.0.1"},"paths":{"/api/clusters/dev_create_from_all_machines_in_inventory":{"post":{"operationId":"dev_create_cluster_from_all_machines_in_inventory","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusterCreationConfig"}}},"required":true},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/clusters/dev_install_basics":{"post":{"operationId":"dev_install_cluster_basics","responses":{"200":{"description":"Installed basics","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/clusters/signal":{"post":{"operationId":"signal_cluster","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusterSignalReqBody"}}},"required":true},"responses":{"200":{"description":"Sent signal","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/clusters/status":{"get":{"operationId":"get_cluster_status","responses":{"200":{"description":"Got the Cluster status","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_ClusterStatusResBody"}}}}}}},"/api/config":{"get":{"operationId":"get_config","responses":{"101":{"description":"Websocket that updates the current config","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ManagerConfig"}}}}}},"put":{"operationId":"update_config","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ManagerConfig"}}},"required":true},"responses":{"200":{"description":"Updates the config stored in memory with the received config","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/health":{"get":{"operationId":"get_health","responses":{"200":{"description":"Got health","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_HealthResBody"}}}}}}},"/api/machines/create":{"post":{"operationId":"create_machines","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineCreationReqBody"}}},"required":true},"responses":{"200":{"description":"Created machines","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/machines/delete":{"delete":{"operationId":"delete_machine","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineDeleteReqBody"}}},"required":true},"responses":{"200":{"description":"Machine deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/machines/dev_delete_all":{"delete":{"operationId":"dev_delete_all_machines","responses":{"200":{"description":"Machines deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/machines/info":{"get":{"operationId":"get_machine_info","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineInfoReqBody"}}},"required":true},"responses":{"200":{"description":"Got machine info","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_MachineInfoResBody"}}}}}}},"/api/machines/signal":{"post":{"operationId":"signal_machine","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineSignalReqBody"}}},"required":true},"responses":{"200":{"description":"Sent signal","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/machines/status":{"get":{"operationId":"get_machine_status","responses":{"200":{"description":"Got the machines status","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_MachineStatusResBody"}}}}}}},"/api/machines/vnc_websocket/{id}":{"get":{"operationId":"get_vnc_websocket","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Got the websocket information","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_VncWebsocket"}}}}}}},"/api/public_ip/create":{"post":{"operationId":"create_public_ip","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PublicIpCreationConfig"}}},"required":true},"responses":{"200":{"description":"Created public static ip address","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse_EmptyApiResponse"}}}}}}},"/api/terminal/{id}":{"get":{"operationId":"direct_terminal","parameters":[{"name":"id","in":"path","description":"The id of the console to connect to, either the machine id or 'local'","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Websocket connection","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/v1/boot/{mac_addr}":{"get":{"operationId":"get_boot_config_by_mac","parameters":[{"name":"mac_addr","in":"path","description":"Mac address of the machine to get boot config for","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Sending boot config to pixieboot server","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PixiecoreBootConfig"}}}},"500":{"description":"Failed to get config for mac address","content":{"text/plain":{"schema":{"type":"string"}}}}}}}},"components":{"schemas":{"ApiResponseStatus":{"type":"string","enum":["Success","Error"]},"ApiResponse_ClusterStatusResBody":{"type":"object","required":["message","status"],"properties":{"data":{"type":"object","required":["id","status"],"properties":{"id":{"type":"string"},"status":{"$ref":"#/components/schemas/ClusterStatus"}}},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"ApiResponse_EmptyApiResponse":{"type":"object","required":["message","status"],"properties":{"data":{"default":null},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"ApiResponse_HealthResBody":{"type":"object","required":["message","status"],"properties":{"data":{"type":"object"},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"ApiResponse_MachineInfoResBody":{"type":"object","required":["message","status"],"properties":{"data":{"type":"object","required":["machine_infos"],"properties":{"machine_infos":{}}},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"ApiResponse_MachineStatusResBody":{"type":"object","required":["message","status"],"properties":{"data":{"type":"object","required":["id","status"],"properties":{"id":{"type":"string"},"status":{"$ref":"#/components/schemas/MachineStatus"}}},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"ApiResponse_VncWebsocket":{"type":"object","required":["message","status"],"properties":{"data":{"type":"object","required":["url","password"],"properties":{"password":{"type":"string"},"url":{"type":"string"}}},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"BackupNode":{"type":"object","required":["machine_id","hostname","mac","ssh"],"properties":{"backup_wg_private_key":{"type":["string","null"]},"hostname":{"type":"string"},"mac":{"type":"string"},"machine_id":{"type":"string"},"ssh":{"$ref":"#/components/schemas/SshAccess"}}},"Cluster":{"type":"object","required":["id","vip","cluster_nodes","k3s_token","backup_nodes","public_ip_config"],"properties":{"backup_nodes":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/BackupNode"},"propertyNames":{"type":"string"}},"cluster_backup_wg_private_key":{"type":["string","null"]},"cluster_nodes":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/ClusterNode"},"propertyNames":{"type":"string"}},"encryption_key":{"type":["string","null"]},"id":{"type":"string"},"install_state":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ClusterInstallState"}]},"k3s_token":{"type":"string"},"kubeconfig":{"type":["string","null"]},"public_ip_config":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/PublicIpConfig"},"propertyNames":{"type":"string"}},"vault_secrets":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/VaultSecrets"}]},"vip":{"$ref":"#/components/schemas/Vip"}}},"ClusterCreationConfig":{"type":"object"},"ClusterInstallState":{"type":"string","enum":["Kubernetes","BasicsConfigured","BasicsReady"]},"ClusterNode":{"type":"object","required":["machine_id","internal_ips","primary"],"properties":{"internal_ips":{"$ref":"#/components/schemas/InternalIps"},"machine_id":{"type":"string"},"primary":{"type":"boolean"}}},"ClusterRunningState":{"type":"string","enum":["Stopped","DriveDecrypted","KubernetesRunning","ControlplaneReady","VaultUnsealed","SystemReady"]},"ClusterSignal":{"type":"string","enum":["Start","Restart","Stop","Suspend","Resume"]},"ClusterSignalReqBody":{"type":"object","required":["signal","cluster_id"],"properties":{"cluster_id":{"type":"string"},"signal":{"$ref":"#/components/schemas/ClusterSignal"}}},"ClusterStatus":{"type":"object","properties":{"install_state":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ClusterInstallState"}]},"running_state":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ClusterRunningState"}]}}},"ClusterStatusResBody":{"type":"object","required":["id","status"],"properties":{"id":{"type":"string"},"status":{"$ref":"#/components/schemas/ClusterStatus"}}},"EmptyApiResponse":{"default":null},"ExternalMachineProviderHcloudConfig":{"type":"object","required":["server_type","location"],"properties":{"location":{"type":"string"},"server_type":{"type":"string"}}},"ExternalProviderConfigHcloud":{"type":"object","required":["api_token"],"properties":{"api_token":{"type":"string"}}},"ExternalProviderConfigMap":{"type":"object","properties":{"hcloud":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ExternalProviderConfigHcloud"}]}}},"HealthResBody":{"type":"object"},"InternalIps":{"type":"object","required":["legacy"],"properties":{"legacy":{"type":"string","format":"Ipv4Addr"}}},"LocalMachineProviderPhysicalConfig":{"type":"object","required":["mac_address"],"properties":{"mac_address":{"type":"string"}}},"LocalMachineProviderQemuConfig":{"type":"object","required":["memory","cpus"],"properties":{"cpus":{"type":"integer","format":"int32","minimum":0},"memory":{"type":"integer","format":"int32","description":"\n     * Memory in GB","minimum":0}}},"Machine":{"type":"object","required":["id","machine_type","ssh"],"properties":{"id":{"type":"string"},"install":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/MachineInstall"}]},"mac":{"type":["string","null"]},"machine_type":{"$ref":"#/components/schemas/MachineType"},"public_ip":{"type":"string","format":"Ipv6Addr"},"public_legacy_ip":{"type":"string","format":"Ipv4Addr"},"ssh":{"$ref":"#/components/schemas/SshAccess"}}},"MachineCreationReqBody":{"type":"object","required":["machines"],"properties":{"machines":{"type":"array","items":{"$ref":"#/components/schemas/MachineCreationReqType"}}}},"MachineCreationReqType":{"oneOf":[{"type":"object","required":["LocalQemu"],"properties":{"LocalQemu":{"$ref":"#/components/schemas/LocalMachineProviderQemuConfig"}}},{"type":"object","required":["LocalPhysical"],"properties":{"LocalPhysical":{"$ref":"#/components/schemas/LocalMachineProviderPhysicalConfig"}}},{"type":"object","required":["ExternalHcloud"],"properties":{"ExternalHcloud":{"$ref":"#/components/schemas/ExternalMachineProviderHcloudConfig"}}}]},"MachineDeleteReqBody":{"type":"object","required":["machine_id"],"properties":{"machine_id":{"type":"string"}}},"MachineInfoReqBody":{"type":"object","required":["machine_id"],"properties":{"machine_id":{"type":"string"}}},"MachineInfoResBody":{"type":"object","required":["machine_infos"],"properties":{"machine_infos":{}}},"MachineInstall":{"type":"object","required":["primary"],"properties":{"boot_config":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/PixiecoreBootConfig"}]},"primary":{"type":"boolean"},"state":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/MachineInstallState"}]}}},"MachineInstallState":{"type":"string","enum":["Configured","Requested","Installed"]},"MachineSignal":{"type":"string","enum":["Start","Reboot","Shutdown","Reset","ForceOff","Suspend","Resume"]},"MachineSignalReqBody":{"type":"object","required":["signal","machine_id"],"properties":{"machine_id":{"type":"string"},"signal":{"$ref":"#/components/schemas/MachineSignal"}}},"MachineStatus":{"type":"string","enum":["Running","Stopped","Unknown","Suspended"]},"MachineStatusResBody":{"type":"object","required":["id","status"],"properties":{"id":{"type":"string"},"status":{"$ref":"#/components/schemas/MachineStatus"}}},"MachineType":{"type":"string","enum":["LocalQemu","LocalPhysical","ExternalHcloud"]},"ManagerConfig":{"type":"object","required":["clusters","machines"],"properties":{"clusters":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Cluster"},"propertyNames":{"type":"string"}},"external_provider_config":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ExternalProviderConfigMap"}]},"machines":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Machine"},"propertyNames":{"type":"string"}}}},"PixiecoreBootConfig":{"type":"object","required":["kernel","initrd","cmdline"],"properties":{"cmdline":{"type":"string"},"initrd":{"type":"array","items":{"type":"string"}},"kernel":{"type":"string"}}},"PublicIpConfig":{"oneOf":[{"type":"object","required":["MachineProxy"],"properties":{"MachineProxy":{"$ref":"#/components/schemas/PublicIpVmProxy"}}}]},"PublicIpCreationConfig":{"type":"object","required":["cluster_id","creation_type"],"properties":{"cluster_id":{"type":"string"},"creation_type":{"$ref":"#/components/schemas/PublicIpCreationConfigType"}}},"PublicIpCreationConfigType":{"oneOf":[{"type":"object","required":["MachineProxy"],"properties":{"MachineProxy":{"type":"array","items":{"type":"string"},"maxItems":2,"minItems":2}}}]},"PublicIpVmProxy":{"type":"object","required":["machine_id","wg_keys"],"properties":{"ip":{"type":"string","format":"Ipv6Addr"},"legacy_ip":{"type":"string","format":"Ipv4Addr"},"machine_id":{"type":"string"},"wg_keys":{"$ref":"#/components/schemas/WgKeys"}}},"SshAccess":{"type":"object","required":["ssh_username","ssh_private_key","ssh_public_key","ssh_passphrase","ssh_password"],"properties":{"remote_hostname":{"type":["string","null"]},"remote_public_key":{"type":["string","null"]},"ssh_passphrase":{"type":"string"},"ssh_password":{"type":"string"},"ssh_private_key":{"type":"string"},"ssh_public_key":{"type":"string"},"ssh_username":{"type":"string"}}},"VaultSecrets":{"type":"object","required":["root_token","unseal_key"],"properties":{"root_token":{"type":"string"},"unseal_key":{"type":"string"}}},"Vip":{"type":"object","required":["service","controlplane"],"properties":{"controlplane":{"$ref":"#/components/schemas/VipIp"},"service":{"$ref":"#/components/schemas/VipIp"}}},"VipIp":{"type":"object","properties":{"ip":{"type":"string","format":"Ipv6Addr"},"legacy_ip":{"type":"string","format":"Ipv4Addr"}}},"VncWebsocket":{"type":"object","required":["url","password"],"properties":{"password":{"type":"string"},"url":{"type":"string"}}},"WgKeys":{"type":"object","required":["remote_wg_private_key","remote_wg_public_key","local_wg_private_key","local_wg_public_key"],"properties":{"local_wg_private_key":{"type":"string"},"local_wg_public_key":{"type":"string"},"remote_wg_private_key":{"type":"string"},"remote_wg_public_key":{"type":"string"}}}}},"tags":[{"name":"mows-manager","description":"Cluster management API"}]}