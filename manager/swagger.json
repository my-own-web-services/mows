{"openapi":"3.0.3","info":{"title":"manager","description":"","license":{"name":""},"version":"0.1.0"},"paths":{"/api/cluster/create":{"post":{"tags":["api"],"operationId":"create_cluster","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusterCreationConfig"}}},"required":true},"responses":{"200":{"description":"Created cluster","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Success"}}}}},"500":{"description":"Failed to create cluster","content":{"application/json":{"schema":{"type":"array","items":{"type":"string"}}}}}}}},"/api/config":{"get":{"tags":["api"],"operationId":"get_config","responses":{"200":{"description":"Gets the config","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Config"}}}}}}},"put":{"tags":["api"],"operationId":"update_config","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Config"}}},"required":true},"responses":{"200":{"description":"Updates the config","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Success"}}}}}}}},"/api/machines/create":{"post":{"tags":["api"],"operationId":"create_machines","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineCreationConfig"}}},"required":true},"responses":{"200":{"description":"Created machines","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Success"}}}}},"500":{"description":"Failed to create machines","content":{"application/json":{"schema":{"type":"array","items":{"type":"string"}}}}}}}}},"components":{"schemas":{"BackupNode":{"type":"object","required":["hostname","mac","ssh_access"],"properties":{"backup_wg_private_key":{"type":"string","nullable":true},"hostname":{"type":"string"},"mac":{"type":"string"},"ssh_access":{"$ref":"#/components/schemas/SshAccess"}}},"Cluster":{"type":"object","required":["cluster_nodes","backup_nodes"],"properties":{"backup_nodes":{"type":"array","items":{"$ref":"#/components/schemas/BackupNode"}},"cluster_backup_wg_private_key":{"type":"string","nullable":true},"cluster_nodes":{"type":"array","items":{"$ref":"#/components/schemas/ClusterNode"}},"encryption_key":{"type":"string","nullable":true},"k3s_token":{"type":"string","nullable":true},"kubeconfig":{"type":"string","nullable":true},"public_ip_config":{"allOf":[{"$ref":"#/components/schemas/PublicIpConfig"}],"nullable":true}}},"ClusterCreationConfig":{"type":"object"},"ClusterNode":{"type":"object","required":["machine","hostname"],"properties":{"hostname":{"type":"string"},"machine":{"$ref":"#/components/schemas/Machine"},"ssh_access":{"allOf":[{"$ref":"#/components/schemas/SshAccess"}],"nullable":true}}},"Config":{"type":"object","required":["clusters","external_providers","unassigned_machines"],"properties":{"clusters":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Cluster"}},"external_providers":{"$ref":"#/components/schemas/ExternalProviders"},"unassigned_machines":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Machine"}}}},"ExternalHetznerConfig":{"type":"object","required":["server_type"],"properties":{"server_type":{"type":"string"}}},"ExternalProviderIpOptions":{"oneOf":[{"type":"object","required":["Hetzner"],"properties":{"Hetzner":{"$ref":"#/components/schemas/ExternalProviderIpOptionsHetzner"}}},{"type":"string","enum":["Own"]}]},"ExternalProviderIpOptionsHetzner":{"type":"object","required":["server_id"],"properties":{"server_id":{"type":"string"},"ssh_access":{"allOf":[{"$ref":"#/components/schemas/SshAccess"}],"nullable":true}}},"ExternalProviders":{"type":"object","properties":{"hetzner":{"allOf":[{"$ref":"#/components/schemas/ExternalProvidersHetzner"}],"nullable":true}}},"ExternalProvidersHetzner":{"type":"object","required":["api_token"],"properties":{"api_token":{"type":"string"}}},"LocalQemuConfig":{"type":"object","required":["memory","cpus"],"properties":{"cpus":{"type":"integer","format":"int32","minimum":0},"memory":{"type":"integer","format":"int32","description":"* Memory in GB","minimum":0}}},"Machine":{"type":"object","required":["machine_type","name"],"properties":{"mac":{"type":"string","nullable":true},"machine_type":{"$ref":"#/components/schemas/MachineType"},"name":{"type":"string"}}},"MachineCreationConfig":{"oneOf":[{"type":"object","required":["LocalQemu"],"properties":{"LocalQemu":{"$ref":"#/components/schemas/LocalQemuConfig"}}},{"type":"object","required":["Local"],"properties":{"Local":{"type":"array","items":{"type":"string"}}}},{"type":"object","required":["ExternalHetzner"],"properties":{"ExternalHetzner":{"$ref":"#/components/schemas/ExternalHetznerConfig"}}}]},"MachineType":{"type":"string","enum":["LocalQemu","Local","ExternalHetzner"]},"PublicIpConfig":{"type":"object","required":["ips"],"properties":{"ips":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/PublicIpConfigSingleIp"}}}},"PublicIpConfigSingleIp":{"type":"object","required":["provider","ip"],"properties":{"ip":{"$ref":"#/components/schemas/IpAddr"},"provider":{"$ref":"#/components/schemas/ExternalProviderIpOptions"}}},"SshAccess":{"type":"object","required":["ssh_username","ssh_private_key","ssh_public_key","ssh_password"],"properties":{"ssh_password":{"type":"string"},"ssh_private_key":{"type":"string"},"ssh_public_key":{"type":"string"},"ssh_username":{"type":"string"}}},"Success":{"type":"object","required":["message"],"properties":{"message":{"type":"string"}}}}},"tags":[{"name":"cluster-manager","description":"Cluster management API"}]}