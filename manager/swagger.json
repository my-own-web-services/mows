{"openapi":"3.0.3","info":{"title":"manager","description":"","license":{"name":""},"version":"0.1.0"},"paths":{"/api/config":{"get":{"tags":["crate"],"operationId":"get_config","responses":{"101":{"description":"Websocket","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ManagerConfig"}}}}}},"put":{"tags":["crate"],"operationId":"update_config","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ManagerConfig"}}},"required":true},"responses":{"200":{"description":"Config updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/dev/cluster/create_from_all_machines_in_inventory":{"post":{"tags":["crate"],"operationId":"dev_create_cluster_from_all_machines_in_inventory","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusterCreationConfig"}}},"required":true},"responses":{"200":{"description":"Cluster creation started...","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/dev/cluster/install_basics":{"post":{"tags":["crate"],"operationId":"dev_install_cluster_basics","responses":{"200":{"description":"Installed basics","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/dev/machines/delete_all":{"delete":{"tags":["crate"],"operationId":"dev_delete_all_machines","responses":{"200":{"description":"Machines deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/machines/create":{"post":{"tags":["crate"],"operationId":"create_machines","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineCreationReqBody"}}},"required":true},"responses":{"200":{"description":"Created machines","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/machines/delete":{"delete":{"tags":["crate"],"operationId":"delete_machine","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineDeleteReqBody"}}},"required":true},"responses":{"200":{"description":"Machine deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/machines/info":{"post":{"tags":["crate"],"operationId":"get_machine_info","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineInfoReqBody"}}},"required":true},"responses":{"200":{"description":"Got machine info","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/machines/signal":{"post":{"tags":["crate"],"operationId":"signal_machine","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineSignalReqBody"}}},"required":true},"responses":{"200":{"description":"Sent signal","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiResponse"}}}}}}},"/api/machines/status":{"get":{"tags":["crate"],"operationId":"get_machine_status","responses":{}}},"/api/terminal/{id}":{"get":{"tags":["crate"],"operationId":"direct_terminal","parameters":[{"name":"id","in":"path","description":"The id of the console to connect to, either the machine id or 'local'","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Websocket connection","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/v1/boot/{mac_addr}":{"get":{"tags":["crate"],"operationId":"get_boot_config_by_mac","parameters":[{"name":"mac_addr","in":"path","description":"Mac address of the machine to get boot config for","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Sending boot config to pixieboot server","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PixiecoreBootConfig"}}}},"500":{"description":"Failed to get config for mac address","content":{"text/plain":{"schema":{"type":"string"}}}}}}}},"components":{"schemas":{"ApiResponse":{"type":"object","required":["message","status"],"properties":{"data":{"allOf":[{"$ref":"#/components/schemas/T"}],"nullable":true},"message":{"type":"string"},"status":{"$ref":"#/components/schemas/ApiResponseStatus"}}},"ApiResponseStatus":{"type":"string","enum":["Success","Error"]},"BackupNode":{"type":"object","required":["machine_id","hostname","mac","ssh"],"properties":{"backup_wg_private_key":{"type":"string","nullable":true},"hostname":{"type":"string"},"mac":{"type":"string"},"machine_id":{"type":"string"},"ssh":{"$ref":"#/components/schemas/SshAccess"}}},"Cluster":{"type":"object","required":["id","vip","cluster_nodes","k3s_token","backup_nodes"],"properties":{"backup_nodes":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/BackupNode"}},"cluster_backup_wg_private_key":{"type":"string","nullable":true},"cluster_nodes":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/ClusterNode"}},"encryption_key":{"type":"string","nullable":true},"id":{"type":"string"},"install_state":{"allOf":[{"$ref":"#/components/schemas/ClusterInstallState"}],"nullable":true},"k3s_token":{"type":"string"},"kubeconfig":{"type":"string","nullable":true},"public_ip_config":{"allOf":[{"$ref":"#/components/schemas/PublicIpConfig"}],"nullable":true},"vip":{"$ref":"#/components/schemas/Vip"}}},"ClusterCreationConfig":{"type":"object"},"ClusterInstallState":{"type":"string","enum":["Kubernetes","BasicsConfigured","BasicsReady"]},"ClusterNode":{"type":"object","required":["machine_id","internal_ips"],"properties":{"internal_ips":{"$ref":"#/components/schemas/InternalIps"},"machine_id":{"type":"string"}}},"ExternalMachineProviderHcloudConfig":{"type":"object","required":["server_type","location"],"properties":{"location":{"type":"string"},"server_type":{"type":"string"}}},"ExternalProviderIpOptionsHetzner":{"type":"object","required":["server_id"],"properties":{"server_id":{"type":"string"},"ssh_access":{"allOf":[{"$ref":"#/components/schemas/SshAccess"}],"nullable":true}}},"LocalMachineProviderQemuConfig":{"type":"object","required":["memory","cpus"],"properties":{"cpus":{"type":"integer","format":"int32","minimum":0},"memory":{"type":"integer","format":"int32","description":"* Memory in GB","minimum":0}}},"Machine":{"type":"object","required":["id","machine_type","ssh"],"properties":{"id":{"type":"string"},"install":{"allOf":[{"$ref":"#/components/schemas/MachineInstall"}],"nullable":true},"mac":{"type":"string","nullable":true},"machine_type":{"$ref":"#/components/schemas/MachineType"},"ssh":{"$ref":"#/components/schemas/SshAccess"}}},"MachineCreationReqBody":{"type":"object","required":["machines"],"properties":{"machines":{"type":"array","items":{"$ref":"#/components/schemas/MachineCreationReqType"}}}},"MachineCreationReqType":{"oneOf":[{"type":"object","required":["LocalQemu"],"properties":{"LocalQemu":{"$ref":"#/components/schemas/LocalMachineProviderQemuConfig"}}},{"type":"object","required":["Local"],"properties":{"Local":{"type":"array","items":{"type":"string"}}}},{"type":"object","required":["ExternalHcloud"],"properties":{"ExternalHcloud":{"$ref":"#/components/schemas/ExternalMachineProviderHcloudConfig"}}}]},"MachineDeleteReqBody":{"type":"object","required":["machine_id"],"properties":{"machine_id":{"type":"string"}}},"MachineInfoReqBody":{"type":"object","required":["machine_id"],"properties":{"machine_id":{"type":"string"}}},"MachineInfoResBody":{"type":"object","required":["machine_infos"],"properties":{"machine_infos":{}}},"MachineInstallState":{"type":"string","enum":["Configured","Requested","Installed"]},"MachineSignal":{"type":"string","enum":["Start","Reboot","Shutdown","Reset","ForceOff"]},"MachineSignalReqBody":{"type":"object","required":["signal","machine_id"],"properties":{"machine_id":{"type":"string"},"signal":{"$ref":"#/components/schemas/MachineSignal"}}},"MachineStatus":{"type":"object","required":["id","status"],"properties":{"id":{"type":"string"},"status":{"type":"string"}}},"MachineType":{"type":"string","enum":["LocalQemu","Local","ExternalHcloud"]},"ManagerConfig":{"type":"object","required":["clusters","machines"],"properties":{"clusters":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Cluster"}},"external_provider_config":{"allOf":[{"$ref":"#/components/schemas/ExternalProviderConfigMap"}],"nullable":true},"machines":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Machine"}}}},"PixiecoreBootConfig":{"type":"object","required":["kernel","initrd","cmdline"],"properties":{"cmdline":{"type":"string"},"initrd":{"type":"array","items":{"type":"string"}},"kernel":{"type":"string"}}},"SshAccess":{"type":"object","required":["ssh_username","ssh_private_key","ssh_public_key","ssh_passphrase","ssh_password"],"properties":{"remote_hostname":{"type":"string","nullable":true},"remote_public_key":{"type":"string","nullable":true},"ssh_passphrase":{"type":"string"},"ssh_password":{"type":"string"},"ssh_private_key":{"type":"string"},"ssh_public_key":{"type":"string"},"ssh_username":{"type":"string"}}}}},"tags":[{"name":"cluster-manager","description":"Cluster management API"}]}