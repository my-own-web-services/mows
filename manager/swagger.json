{"openapi":"3.0.3","info":{"title":"manager","description":"","license":{"name":""},"version":"0.1.0"},"paths":{"/api/cluster/create":{"post":{"tags":["crate"],"operationId":"create_cluster","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClusterCreationConfig"}}},"required":true},"responses":{"200":{"description":"Created cluster","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Success"}}}},"500":{"description":"Failed to create cluster","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/config":{"get":{"tags":["crate"],"operationId":"get_config","responses":{"101":{"description":"Websocket","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ManagerConfig"}}}}}},"put":{"tags":["crate"],"operationId":"update_config","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ManagerConfig"}}},"required":true},"responses":{"200":{"description":"Updates the config","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Success"}}}},"500":{"description":"Failed to update config","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/machines/create":{"post":{"tags":["crate"],"operationId":"create_machines","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineCreationReqBody"}}},"required":true},"responses":{"200":{"description":"Created machines","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Success"}}}},"500":{"description":"Failed to create machines","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/machines/delete":{"delete":{"tags":["crate"],"operationId":"delete_machine","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineDeleteReqBody"}}},"required":true},"responses":{"200":{"description":"Machine deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Success"}}}},"500":{"description":"Failed to delete machines","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/machines/info":{"post":{"tags":["crate"],"operationId":"get_machine_info","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineInfoReqBody"}}},"required":true},"responses":{"200":{"description":"Got machine info","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineInfoResBody"}}}},"500":{"description":"Failed to get info","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/machines/signal":{"post":{"tags":["crate"],"operationId":"signal_machine","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineSignalReqBody"}}},"required":true},"responses":{"200":{"description":"Sent signal","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Success"}}}},"500":{"description":"Failed to send signal","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/machines/status":{"get":{"tags":["crate"],"operationId":"get_machine_status","responses":{}}},"/api/terminal/local":{"get":{"tags":["crate"],"operationId":"terminal_local","responses":{"200":{"description":"Websocket connection","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/v1/boot/{mac_addr}":{"get":{"tags":["crate"],"operationId":"get_boot_config_by_mac","parameters":[{"name":"mac_addr","in":"path","description":"Mac address of the machine to get boot config for","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Sending boot config to pixieboot server","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Success"}}}},"500":{"description":"Failed to get config for mac address","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PixiecoreBootConfig"}}}}}}}},"components":{"schemas":{"BackupNode":{"type":"object","required":["machine_id","hostname","mac","ssh"],"properties":{"backup_wg_private_key":{"type":"string","nullable":true},"hostname":{"type":"string"},"mac":{"type":"string"},"machine_id":{"type":"string"},"ssh":{"$ref":"#/components/schemas/SshAccess"}}},"Cluster":{"type":"object","required":["id","cluster_nodes","k3s_token","backup_nodes"],"properties":{"backup_nodes":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/BackupNode"}},"cluster_backup_wg_private_key":{"type":"string","nullable":true},"cluster_nodes":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/ClusterNode"}},"encryption_key":{"type":"string","nullable":true},"id":{"type":"string"},"install_state":{"allOf":[{"$ref":"#/components/schemas/ClusterInstallState"}],"nullable":true},"k3s_token":{"type":"string"},"kubeconfig":{"type":"string","nullable":true},"public_ip_config":{"allOf":[{"$ref":"#/components/schemas/PublicIpConfig"}],"nullable":true}}},"ClusterCreationConfig":{"type":"object"},"ClusterInstallState":{"type":"string","enum":["Kubernetes","Basics"]},"ClusterNode":{"type":"object","required":["machine_id","hostname","ssh"],"properties":{"hostname":{"type":"string"},"machine_id":{"type":"string"},"ssh":{"$ref":"#/components/schemas/SshAccess"}}},"ExternalHetznerConfig":{"type":"object","required":["server_type"],"properties":{"server_type":{"type":"string"}}},"ExternalProviderIpOptions":{"oneOf":[{"type":"object","required":["Hetzner"],"properties":{"Hetzner":{"$ref":"#/components/schemas/ExternalProviderIpOptionsHetzner"}}},{"type":"string","enum":["Own"]}]},"ExternalProviderIpOptionsHetzner":{"type":"object","required":["server_id"],"properties":{"server_id":{"type":"string"},"ssh_access":{"allOf":[{"$ref":"#/components/schemas/SshAccess"}],"nullable":true}}},"ExternalProviders":{"type":"object","properties":{"hetzner":{"allOf":[{"$ref":"#/components/schemas/ExternalProvidersHetzner"}],"nullable":true}}},"ExternalProvidersHetzner":{"type":"object","required":["api_token"],"properties":{"api_token":{"type":"string"}}},"LocalQemuConfig":{"type":"object","required":["memory","cpus"],"properties":{"cpus":{"type":"integer","format":"int32","minimum":0},"memory":{"type":"integer","format":"int32","description":"* Memory in GB","minimum":0}}},"Machine":{"type":"object","required":["id","machine_type"],"properties":{"id":{"type":"string"},"install":{"allOf":[{"$ref":"#/components/schemas/MachineInstall"}],"nullable":true},"last_ip":{"allOf":[{"$ref":"#/components/schemas/IpAddr"}],"nullable":true},"mac":{"type":"string","nullable":true},"machine_type":{"$ref":"#/components/schemas/MachineType"}}},"MachineCreationReqBody":{"oneOf":[{"type":"object","required":["LocalQemu"],"properties":{"LocalQemu":{"$ref":"#/components/schemas/LocalQemuConfig"}}},{"type":"object","required":["Local"],"properties":{"Local":{"type":"array","items":{"type":"string"}}}},{"type":"object","required":["ExternalHetzner"],"properties":{"ExternalHetzner":{"$ref":"#/components/schemas/ExternalHetznerConfig"}}}]},"MachineDeleteReqBody":{"type":"object","required":["machine_id"],"properties":{"machine_id":{"type":"string"}}},"MachineInfoReqBody":{"type":"object","required":["machine_id"],"properties":{"machine_id":{"type":"string"}}},"MachineInfoResBody":{"type":"object","required":["machine_infos"],"properties":{"machine_infos":{}}},"MachineInstallState":{"type":"string","enum":["Configured","Requested","Installed"]},"MachineSignal":{"type":"string","enum":["Start","Reboot","Shutdown","Reset","ForceOff"]},"MachineSignalReqBody":{"type":"object","required":["signal","machine_id"],"properties":{"machine_id":{"type":"string"},"signal":{"$ref":"#/components/schemas/MachineSignal"}}},"MachineStatus":{"type":"object","required":["id","status"],"properties":{"id":{"type":"string"},"status":{"type":"string"}}},"MachineType":{"type":"string","enum":["LocalQemu","Local","ExternalHetzner"]},"ManagerConfig":{"type":"object","required":["clusters","external_providers","machines"],"properties":{"clusters":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Cluster"}},"external_providers":{"$ref":"#/components/schemas/ExternalProviders"},"machines":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/Machine"}}}},"PixiecoreBootConfig":{"type":"object","required":["kernel","initrd","cmdline"],"properties":{"cmdline":{"type":"string"},"initrd":{"type":"array","items":{"type":"string"}},"kernel":{"type":"string"}}},"PublicIpConfig":{"type":"object","required":["ips"],"properties":{"ips":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/PublicIpConfigSingleIp"}}}},"PublicIpConfigSingleIp":{"type":"object","required":["provider","ip"],"properties":{"ip":{"$ref":"#/components/schemas/IpAddr"},"provider":{"$ref":"#/components/schemas/ExternalProviderIpOptions"}}},"SshAccess":{"type":"object","required":["ssh_username","ssh_private_key","ssh_public_key","ssh_passphrase","ssh_password"],"properties":{"remote_fingerprint":{"type":"string","nullable":true},"ssh_passphrase":{"type":"string"},"ssh_password":{"type":"string"},"ssh_private_key":{"type":"string"},"ssh_public_key":{"type":"string"},"ssh_username":{"type":"string"}}},"Success":{"type":"object","required":["message"],"properties":{"message":{"type":"string"}}}}},"tags":[{"name":"cluster-manager","description":"Cluster management API"}]}