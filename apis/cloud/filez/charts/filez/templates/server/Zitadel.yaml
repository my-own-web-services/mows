apiVersion: zitadel.k8s.mows.cloud/v1
kind: ZitadelResource
metadata:
    name: filez-oidc
spec:
    raw:
        resource:
            project:
                projectRoleAssertion: true
                projectRoleCheck: true
                roles:
                    -   key: users
                        group: users
                        displayName: Users
                adminRoles: ["users"]
                applications:
                    -   name: filez-server
                        clientDataTarget: 
                            vault:
                                secretEngineName: filez-auth
                                secretEngineSubPath: filez-server
                                kubernetesAuthEngineName: zitadel-controller-service-account
                        method:
                            api:
                                authenticationMethod: basic
                    -   name: filez-web-frontend
                        clientDataTarget: 
                            vault:
                                secretEngineName: filez-auth
                                secretEngineSubPath: filez-web-frontend
                                kubernetesAuthEngineName: zitadel-controller-service-account
                        method:
                            oidc:
                                redirectUris:
                                    - https://filez-api.{ยง .config.domain ยง}/auth/callback
                                responseTypes:
                                    - code
                                authenticationMethod: basic
                                grantTypes:
                                    - authorizationCode
                                postLogoutRedirectUris:
                                    - https://filez-api.{ยง .config.domain ยง}
                                appType: userAgent
                                accessTokenType: bearer
                                idTokenRoleAssertion: true
                                idTokenUserinfoAssertion: true
          
