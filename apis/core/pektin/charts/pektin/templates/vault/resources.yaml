apiVersion: vault.k8s.mows.cloud/v1
kind: VaultResource
metadata:
    name: pektin-signing
spec:
    secretEngine:
        transit: {}
---
apiVersion: vault.k8s.mows.cloud/v1
kind: VaultResource
metadata:
    name: pektin-policies
spec:
    secretEngine:
        kv-v2:
            kvData:
                pektin-zertificat:
                    data: |- {{ range .Files.Lines "policies/ribston/acme.ribston.js" }}
                        {{ . }}{{ end }}
                         
---
apiVersion: vault.k8s.mows.cloud/v1
kind: VaultResource
metadata:
    name: pektin-api-policy
spec:
    engineAccessPolicy:
        subPolicies:
            - engineId: pektin-signing
              engineType: secret
              subPath: "*"
              capabilities: ["update", "read"]
            - engineId: pektin-policies
              engineType: secret
              subPath: "*"
              capabilities: ["read"]

---
apiVersion: vault.k8s.mows.cloud/v1
kind: VaultResource
metadata:
    name: pektin-kubernetes
spec:
    authEngine:
        kubernetes:
            roles:
                pektin-api:
                    serviceAccountName: pektin-api
                    policyIds: ["pektin-api-policy"]

