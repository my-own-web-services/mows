
apiVersion: zitadel.k8s.mows.cloud/v1
kind: ZitadelResource
metadata:
    name: mows-org
spec:
    raw:
        resource:
            org:
                name: "mows"
---
            
apiVersion: zitadel.k8s.mows.cloud/v1
kind: ZitadelResource
metadata:
    name: argocd-oidc
spec:
    raw:
        resource:
            project:
                name: "argocd"
                orgName: "mows"
                projectRoleAssertion: true
                projectRoleCheck: true
                roles:
                    -   key: argocd_administrators
                        group: argocd_administrators
                        displayName: Administrators
                    -   key: argocd_users
                        group: argocd_users
                        displayName: Users
                adminRoles: ["argocd_administrators", "argocd_users"]
                applications:
                    -   name: argocd
                        clientDataTarget: 
                            vault:
                                secretEngineName: argocd-oidc
                                secretEngineSubPath: oidc
                                kubernetesAuthEngineName: zitadel-controller-service-account
                        method:
                            oidc:
                                redirectUris:
                                    - https://argocd.{ยง .config.domain ยง}/auth/callback
                                responseTypes:
                                    - code
                                authenticationMethod: basic
                                grantTypes:
                                    - authorizationCode
                                postLogoutRedirectUris:
                                    - https://argocd.{ยง .config.domain ยง}
                                appType: web
                                accessTokenType: bearer
                                idTokenRoleAssertion: true
                                idTokenUserinfoAssertion: true

