# yaml-language-server: $schema=https://git.vindelicum.eu/firstdorsal/mows/-/raw/main/operators/zitadel-resource-controller/ZitadelResourceCRDSchema.json?ref_type=heads
apiVersion: zitadel.k8s.mows.cloud/v1
kind: ZitadelResource
metadata:
    name: stalwart-auth
spec:
    raw:
        resource:
            project:
                projectRoleAssertion: true
                projectRoleCheck: true
                roles:
                    - key: users
                      group: users
                      displayName: Users
                    - key: superadmins
                      group: superadmins
                      displayName: Super Admins
                adminRoles: ["users", "superadmins"]
                applications:
                    - name: "stalwart-web"
                      clientDataTarget:
                          vault:
                              secretEngineName: stalwart-auth
                              secretEngineSubPath: "{{ .Values.server.name }}"
                              kubernetesAuthEngineName: zitadel-controller-service-account
                      method:
                          oidc:
                              redirectUris:
                                  - https://{{ .Values.server.defaultHostname }}

                              responseTypes:
                                  - code
                              authenticationMethod: basic
                              grantTypes:
                                  - authorizationCode
                              postLogoutRedirectUris:
                                  - https://{{ .Values.server.defaultHostname }}
                              appType: web
                              accessTokenType: bearer
                              idTokenRoleAssertion: true
                              idTokenUserinfoAssertion: true
